<!DOCTYPE html>
<html>
<head>
<title>Users</title>
<meta charset="utf-8">
<style>

.bar {
  fill: steelblue;
}

.bar:hover {
  fill: brown;
}

.axis {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {
  display: none;
}

</style>
</head>
<body>
<select id="smallCountsSelect" onchange="smallCountsSelectChange()">
<option value="1">Number of Users with 1 - 10 Tweets</option>
<option value="11">Number of Users with 11 - 20 Tweets</option>
<option value="21">Number of Users with 21 - 30 Tweets</option>
<option value="31">Number of Users with 31 - 40 Tweets</option>
<option value="41">Number of Users with 41 - 50 Tweets</option>
<option value="51">Number of Users with 51 - 60 Tweets</option>
<option value="61">Number of Users with 61 - 70 Tweets</option>
<option value="71">Number of Users with 71 - 80 Tweets</option>
<option value="81">Number of Users with 81 - 90 Tweets</option>
<option value="91">Number of Users with 91 - 99 Tweets</option>
</select>
<div id="smallCountsChart"></div>

<script src="d3.v3.min.js"></script>
<script>
var world; //ScreenName summary 

function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
};


var drawSmallCounts = function(data,div) {
	console.log('drawSmallCounts: '+div);
	
	var margin = {top: 20, right: 20, bottom: 30, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

	var x = d3.scale.ordinal().rangeRoundBands([0, width]);

	var y = d3.scale.linear().range([height, 0]);

	var xAxis = d3.svg.axis().scale(x).orient('bottom').tickFormat(function(d) { return data[d].name; });

	var yAxis = d3.svg.axis().scale(y).orient('left');
	
	x.domain(data.map(function(d,i) { return i; }));
  	y.domain([0,d3.max(data,function(d) { return d.count; })]);


	var svg = d3.select('#'+div).append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom)
  .append('g')
    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

	svg.append('g')
      .attr('class', 'x axis')
      .attr('transform', 'translate(0,' + height + ')')
      .call(xAxis);
      
	svg.append('g')
      .attr('class', 'y axis')
      .call(yAxis)
    .append('text')
      .attr('transform', 'rotate(-90)')
      .attr('y', 6)
      .attr('dy', '.71em')
      .style('text-anchor', 'end')
      .text('# Tweeters');
      

	svg.selectAll('.bar')
      .data(data)
    .enter().append('rect')
      .attr('class', 'bar' )
      .attr('y', function(d,i) { return y(d.count); })
      .attr('width', x.rangeBand())
      .attr('x', function(d,i) { return x(i); })
      .attr('height', function(d) { return height - y(d.count); })
      .append("svg:title")
				.text(function(d, i) {
					return d.name+': '+numberWithCommas(d.count)+' users';
				});
	console.log('done');

};

var smallCountsSelectChange = function() {
	var s = document.getElementById('smallCountsSelect');
	var req = s[s.selectedIndex].value;
	
	//remove old chart
	var c = document.getElementById("smallCountsChart");
	while (c.firstChild) {
   	c.removeChild(c.firstChild);
	}
	switch(req) {
		case '1':
			drawSmallCounts(world.smallCounts.slice(1,11),'smallCountsChart');
			break;
		case '11':
			drawSmallCounts(world.smallCounts.slice(11,21),'smallCountsChart');
			break;
		case '21':
			drawSmallCounts(world.smallCounts.slice(21,31),'smallCountsChart');
			break;
		case '31':
			drawSmallCounts(world.smallCounts.slice(31,41),'smallCountsChart');
			break;
		case '41':
			drawSmallCounts(world.smallCounts.slice(41,51),'smallCountsChart');
			break;
		case '51':
			drawSmallCounts(world.smallCounts.slice(51,61),'smallCountsChart');
			break;
		case '61':
			drawSmallCounts(world.smallCounts.slice(61,71),'smallCountsChart');
			break;
		case '71':
			drawSmallCounts(world.smallCounts.slice(71,81),'smallCountsChart');
			break;
		case '81':
			drawSmallCounts(world.smallCounts.slice(81,91),'smallCountsChart');
			break;
		case '91':
			drawSmallCounts(world.smallCounts.slice(91),'smallCountsChart');
			break;
		default:
			console.error('Invalid smallCounts selection: '+req);
			break;
	}
};


//Load the ScreenName summary
d3.json("/summary?location=ScreenName", function(error, json) {
	console.log('Got data');
	if (error) { return console.warn(error); }
	world = json; //Cache the full summary report
	drawSmallCounts(world.smallCounts.slice(1,11),'smallCountsChart');
	
});



</script>
</body>
</html>